

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Engine &mdash; Auto-Processor 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Auto-Processor 0.1 documentation" href="index.html" />
    <link rel="next" title="Core Library" href="Core/core.html" />
    <link rel="prev" title="Welcome to SAXS Auto Protein Analysis Pipeline3’s documentation!" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Core/core.html" title="Core Library"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to SAXS Auto Protein Analysis Pipeline3’s documentation!"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Auto-Processor 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-Engine">
<span id="engine"></span><h1>Engine<a class="headerlink" href="#module-Engine" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Engine.Engine">
<em class="property">class </em><tt class="descclassname">Engine.</tt><tt class="descname">Engine</tt><big>(</big><em>configuration</em><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine" title="Permalink to this definition">¶</a></dt>
<dd><p>Is the goto man for controlling the sequence of events that will occur after a datFile has been created</p>
<dl class="method">
<dt id="Engine.Engine.connectWorkers">
<tt class="descname">connectWorkers</tt><big>(</big><em>instanceDict</em><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.connectWorkers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.connectWorkers" title="Permalink to this definition">¶</a></dt>
<dd><p>Connects all Workers to required ZMQ sockets
Loads each worker into a Daemon Thread
Uses Push for all workers
PUB/SUB for WorkerDB
REQ/REP for WorkerBufferAverage</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>instanceDict (dictionary): Dictionary created from instantiateWorkers</dd>
<dt>Returns:</dt>
<dd>Nothing</dd>
<dt>Sets Class Variables:</dt>
<dd><div class="first last line-block">
<div class="line">self.connectedWorkers = Dictionary - key, Worker(string): push port(string)</div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.createDB">
<tt class="descname">createDB</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.createDB"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.createDB" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the specified database for the new user</p>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.exit">
<tt class="descname">exit</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.exit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.exit" title="Permalink to this definition">¶</a></dt>
<dd><p>Properly shuts down all the workers</p>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.getDatFile">
<tt class="descname">getDatFile</tt><big>(</big><em>fullPath</em><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.getDatFile"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.getDatFile" title="Permalink to this definition">¶</a></dt>
<dd><div class="line-block">
<div class="line">Called from lineCreated, is called if we want the datFile from the log line</div>
<div class="line">It looks in the location created from the configuration file for the corresponding datFile</div>
<div class="line">Times out after 3seconds and passes</div>
</div>
<dl class="docutils">
<dt>Args:</dt>
<dd>fullPath (String): Absolute location of the datFile from the LogLine</dd>
<dt>Returns:</dt>
<dd><div class="first last line-block">
<div class="line">datFile object created from the static image</div>
<div class="line">or, returns False if nothing is found</div>
</div>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.instantiateWorkers">
<tt class="descname">instantiateWorkers</tt><big>(</big><em>workers</em><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.instantiateWorkers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.instantiateWorkers" title="Permalink to this definition">¶</a></dt>
<dd><p>Instantiates each worker as specified by the Configuration</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>Workers: A list of string names of each worker</dd>
<dt>Returns:</dt>
<dd>instanceDict: A dictionary of Key (Worker Name String): Value (Instantiated Worker Object)</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.killLogWatcher">
<tt class="descname">killLogWatcher</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.killLogWatcher"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.killLogWatcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Kills Log Watcher Object</p>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.lineCreated">
<tt class="descname">lineCreated</tt><big>(</big><em>line</em>, <em>**kw</em><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.lineCreated"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.lineCreated" title="Permalink to this definition">¶</a></dt>
<dd><div class="line-block">
<div class="line">Here we parse the logline for the Image Location</div>
<div class="line">it Preliminarily checks against the image type for weather it needs to bother looking for it or not </div>
<div class="line">Calls processDat if we care for the datFile</div>
<div class="line">sends the logline to be written out to the database</div>
</div>
<dl class="docutils">
<dt>Args:</dt>
<dd>line (string): returned latest line from call back
<a href="#id1"><span class="problematic" id="id2">**</span></a>kw (dictionary): any more remaining values</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.newUser">
<tt class="descname">newUser</tt><big>(</big><em>user</em><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.newUser"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.newUser" title="Permalink to this definition">¶</a></dt>
<dd><p>New User has been found, need to communicate to myself and all workers the new details
A new Database is created
And the engine commences watching the logfile.</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>user (string): string value of the user</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.processDat">
<tt class="descname">processDat</tt><big>(</big><em>logLine</em>, <em>datFile</em><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.processDat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.processDat" title="Permalink to this definition">¶</a></dt>
<dd><div class="line-block">
<div class="line">Here we will decide how to process the datFile</div>
<div class="line">Sample Types:</div>
<div class="line">6 - Water</div>
<div class="line">0 - Buffer</div>
<div class="line">1 - Static Sample</div>
</div>
<div class="line-block">
<div class="line">Sample type of DatFile is determined by the logline.  We only currently care for 0 (buffer), or 1 (static Sample)</div>
<div class="line">Is sample is a buffer, it needs to be passed to WorkerBufferAverage to be processed</div>
<div class="line">If it is a sample it is passed to all workers to be processed by them if they want</div>
</div>
<p>We check if the Workers need an AveragedBuffer which we then can request from WorkerBufferAverage
We check for a rootname change indicating a new sample which may or may not require a new buffer average</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>logLine (LogLine Object): Latest Logline
datFile (datFile Object): Corresponding DatFile from LogLine</dd>
<dt>Raises:</dt>
<dd>IndexError: Raised only on first pass, as we need the current user to check againse the previous user</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.requestAveragedBuffer">
<tt class="descname">requestAveragedBuffer</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.requestAveragedBuffer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.requestAveragedBuffer" title="Permalink to this definition">¶</a></dt>
<dd><p>Request from the WorkerBufferAverage for the current averaged buffer</p>
<dl class="docutils">
<dt>Returns:</dt>
<dd>Averaged Buffer List</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.run">
<tt class="descname">run</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Starts the epics watcher for user change
Keeps on running as the main thread</p>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.sendCommand">
<tt class="descname">sendCommand</tt><big>(</big><em>command</em><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.sendCommand"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.sendCommand" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends a structed Dictionary command to all connected Workers</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>command (Dictionary): requested command to be sent</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.sendLogLine">
<tt class="descname">sendLogLine</tt><big>(</big><em>line</em><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.sendLogLine"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.sendLogLine" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends the pass logline to the WorkerDB to be written out to the database</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>line (LogLine object): LogLine object that you want to write to the DB</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.setConfiguration">
<tt class="descname">setConfiguration</tt><big>(</big><em>configuration</em><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.setConfiguration"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.setConfiguration" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads the default configuration file that is passed at object creation 
The configuration stores the Workers that need to be loaded, whether an Experiment name is being used, this allows for any workers
to be loaded dynamically at run time.        
The Absolute location of the datFiles.
Any PV&#8217;s that need to be watched</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>Configuration (file): A YAML config file</dd>
<dt>Returns:</dt>
<dd>Nothing</dd>
<dt>Sets class Variables:</dt>
<dd><div class="first last line-block">
<div class="line">self.rootDirectory = The absolute location of the experiments as mounted on the local machine.</div>
<div class="line">self.userChangePV = The FullPath PV from epics to watch for user/experiment change over.</div>
<div class="line">self.experimentFolderOn = Switch if they experiment folders are being used.</div>
<div class="line">self.workrs = List of all workers that need to be instantiated.</div>
</div>
</dd>
<dt>Raises:</dt>
<dd>IOError: When it is unable to find the configuration</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.setLoggingDetails">
<tt class="descname">setLoggingDetails</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.setLoggingDetails"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.setLoggingDetails" title="Permalink to this definition">¶</a></dt>
<dd><p>Current generic logging setup using the python logging module</p>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.setUser">
<tt class="descname">setUser</tt><big>(</big><em>char_value</em>, <em>**kw</em><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.setUser"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.setUser" title="Permalink to this definition">¶</a></dt>
<dd><div class="line-block">
<div class="line">Sets the User for the Engine, and all workers.</div>
<div class="line">Is called when the PV changes</div>
<div class="line">Checks new user value against previous user</div>
<div class="line">If matching values, nothing occurs</div>
<div class="line">Calls newUser(user) if it is a new user</div>
</div>
<dl class="docutils">
<dt>Args:</dt>
<dd>char_value (string): String value of the PV, should be the full path to the image locations relative to epics
<a href="#id3"><span class="problematic" id="id4">**</span></a>kw (dict): remaining values returned from epics</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.setUserWatcher">
<tt class="descname">setUserWatcher</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.setUserWatcher"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.setUserWatcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets up a epics.camonitor against the PV set by the configuration file</p>
<dl class="docutils">
<dt>Callback:</dt>
<dd>setUser()</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="Engine.Engine.watchForLogLines">
<tt class="descname">watchForLogLines</tt><big>(</big><em>logLocation</em><big>)</big><a class="reference internal" href="_modules/Engine.html#Engine.watchForLogLines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#Engine.Engine.watchForLogLines" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates an object for watching the logfile that callsback when ever a new line has been written</p>
<dl class="docutils">
<dt>Callback:</dt>
<dd>lineCreated()</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to SAXS Auto Protein Analysis Pipeline3&#8217;s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Core/core.html"
                        title="next chapter">Core Library</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/engine.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Core/core.html" title="Core Library"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to SAXS Auto Protein Analysis Pipeline3’s documentation!"
             >previous</a> |</li>
        <li><a href="index.html">Auto-Processor 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jack Dwyer.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>